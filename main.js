(()=>{"use strict";var e="https://nomoreparties.co/v1/wff-cohort-6",t={cardsUrl:"".concat(e,"/cards"),profileUrl:"".concat(e,"/users/me"),headers:{authorization:"cd80947a-62e4-4e76-8bb9-39bdbd94fb7a","Content-Type":"application/json"}},n=function(e){return fetch(e.url,{method:void 0===e.method?"GET":e.method,headers:t.headers,body:void 0===e.data?null:JSON.stringify(e.data)}).then((function(t){return function(e,t){return e.ok?e.json():Promise.reject("".concat(t,": ").concat(e.status))}(t,e.errMessage)}))},o=function(e){return n({url:t.profileUrl,method:"PATCH",data:e,errMessage:"Ошибка изменения профиля пользователя"})},r=function(e){return n({url:t.cardsUrl,method:"POST",data:e,errMessage:"Ошибка добавления новой карточки"})},c=function(t){return n({url:"".concat(e,"/cards/likes/").concat(t),method:"PUT",errMessage:"Ошибка добавления лайка"})},a=function(t){return n({url:"".concat(e,"/cards/likes/").concat(t),method:"DELETE",errMessage:"Ошибка удаления лайка"})},u=function(e){return n({url:"".concat(t.profileUrl,"/avatar"),method:"PATCH",data:e,errMessage:"Ошибка изменения аватара пользователя"})},i=document.querySelector("#card-template").content.querySelector(".places__item"),l="card__like-button_is-active",s=function(e,t,n){var o,r,c=i.cloneNode(!0),a=c.querySelector(".card__title"),u=c.querySelector(".card__image"),s=c.querySelector(".card__like-number"),d=c.querySelector(".card__delete-button"),p=c.querySelector(".card__like-button");return a.textContent=e.name,u.src=e.link,u.alt="Пейзажное фото места "+e.name,s.textContent=e.likes.length,t._id===e.owner._id?d.addEventListener("click",(function(t){n.deleteCardCallback(t,e._id)})):d.classList.add("card__delete-button_is-hidden"),o=e.likes,r=t,o.some((function(e){return e._id===r._id}))&&p.classList.add(l),p.addEventListener("click",(function(t){n.likeButtonCallback(t,e)})),u.addEventListener("click",(function(){n.zoomPhotoCallback(a.textContent,u.src,e.name)})),c},d=function(e){"Escape"===e.key&&_(document.querySelector(".popup_is-opened"))},p=function(e,t){var n=e.querySelector("button[type='submit']");null!==n&&(n.textContent=t?"Сохранение...":"Сохранить")},f=function(e){e.target.classList.contains("popup")&&_(document.querySelector(".popup_is-opened"))},m=function(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",d),p(e,!1)},_=function(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",d)},v=function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),o.classList.remove(n.errorClass),o.textContent=""},y=document.querySelector(".places__list"),S=document.querySelector(".popup_type_image"),h=document.querySelector(".popup_type_edit"),C=document.querySelector(".popup_type_new-card"),b=document.querySelector(".popup_type_avatar-edit"),q=document.querySelector(".profile__edit-button"),k=document.querySelector(".profile__add-button"),g=document.querySelector(".profile__image"),L=S.querySelector(".popup__image"),E=S.querySelector(".popup__caption"),x=document.querySelector("[name='edit-profile']"),M=document.querySelector(".profile__title"),B=document.querySelector(".profile__image"),P=document.querySelector(".profile__description"),U=document.querySelector("form[name='new-place']"),A=U.querySelector("input[name='place-name']"),T=U.querySelector("input[name='link']"),w=document.querySelector("form[name='avatar']"),F=w.querySelector("input[name='avatar-link']"),R={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},j={deleteCardCallback:function(e,o){var r=e.target.closest(".places__item");(function(e){return n({url:"".concat(t.cardsUrl,"/").concat(e),method:"DELETE",errMessage:"Ошибка удаления карточки"})})(o).then((function(e){r.remove()})).catch((function(e){console.log(e)}))},likeButtonCallback:function(e,t){var n=e.target,o=e.target.closest(".card__like").querySelector(".card__like-number");(n.classList.contains(l)?a:c)(t._id).then((function(e){o.textContent=e.likes.length,n.classList.toggle(l)})).catch((function(e){console.log(e)}))},zoomPhotoCallback:function(e,t,n){E.textContent=e,L.src=t,L.alt=n,L.onload=function(){m(S)}}},z=function(e){var t=e.popup.querySelector("form");e.event.preventDefault(),p(e.popup,!0),e.fetchFunction(e.data).then((function(t){e.processResult(t)})).catch((function(e){console.log(e)})).finally((function(){_(e.popup),t.reset()}))};Promise.all([n({url:t.cardsUrl,errMessage:"Ошибка получения карточек"}),n({url:t.profileUrl,errMessage:"Ошибка получения профиля пользователя"})]).then((function(e){var t=e[0],n=e[1];t.forEach((function(e){y.append(s(e,n,j))})),function(e){M.textContent=e.name,P.textContent=e.about,B.style.backgroundImage="url('".concat(e.avatar,"')")}(n)})).catch((function(e){console.log(e)})),[S,h,C,b].forEach((function(e){e.querySelector(".popup__close").addEventListener("click",(function(){_(e)})),e.addEventListener("click",f),e.classList.add("popup_is-animated")}));var D=function(e){var t=e.popup.querySelector("form");e.refreshContent?e.refreshContent():t.reset(),function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);n.forEach((function(n){v(e,n,t),n.setCustomValidity("")})),o.classList.add(t.inactiveButtonClass),o.disabled=!0}(t,R),m(e.popup)};q.addEventListener("click",(function(){D({popup:h,refreshContent:function(){x.name.value=M.textContent,x.description.value=P.textContent}})})),k.addEventListener("click",(function(){D({popup:C})})),g.addEventListener("click",(function(){D({popup:b})})),x.addEventListener("submit",(function(e){var t={name:x.name.value,about:x.description.value};z({event:e,popup:h,fetchFunction:o,data:t,processResult:function(e){M.textContent=e.name,P.textContent=e.about}})})),U.addEventListener("submit",(function(e){var t={name:A.value,link:T.value};z({event:e,popup:C,fetchFunction:r,data:t,processResult:function(e){var t=s(e,e.owner,j);y.prepend(t)}})})),w.addEventListener("submit",(function(e){var t={avatar:F.value};z({event:e,popup:b,fetchFunction:u,data:t,processResult:function(e){B.style.backgroundImage="url('".concat(e.avatar,"')")}})})),function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){!function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);n.forEach((function(r){r.addEventListener("input",(function(){!function(e,t,n){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorPatternMessage):t.setCustomValidity(""),t.validity.valid?v(e,t,n):function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.add(n.inputErrorClass),o.textContent=t.validationMessage,o.classList.add(n.errorClass)}(e,t,n)}(e,r,t),function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove(n.inactiveButtonClass),t.disabled=!1):(t.classList.add(n.inactiveButtonClass),t.disabled=!0)}(n,o,t)}))}))}(t,e)}))}(R)})();