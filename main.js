(()=>{"use strict";var e="https://nomoreparties.co/v1/wff-cohort-6",t={cardsUrl:"".concat(e,"/cards"),profileUrl:"".concat(e,"/users/me"),headers:{authorization:"cd80947a-62e4-4e76-8bb9-39bdbd94fb7a","Content-Type":"application/json"}},n=function(e){return fetch(e.url,{method:void 0===e.method?"GET":e.method,headers:t.headers,body:void 0===e.data?null:JSON.stringify(e.data)}).then((function(t){return function(e,t){return e.ok?e.json():Promise.reject("".concat(t,": ").concat(e.status))}(t,e.errMessage)}))},o=function(e){return n({url:t.profileUrl,method:"PATCH",data:e,errMessage:"Ошибка изменения профиля пользователя"})},r=function(e){return n({url:t.cardsUrl,method:"POST",data:e,errMessage:"Ошибка добавления новой карточки"})},c=function(t){return n({url:"".concat(e,"/cards/likes/").concat(t),method:"PUT",errMessage:"Ошибка добавления лайка"})},a=function(t){return n({url:"".concat(e,"/cards/likes/").concat(t),method:"DELETE",errMessage:"Ошибка удаления лайка"})},u=function(e){return n({url:"".concat(t.profileUrl,"/avatar"),method:"PATCH",data:e,errMessage:"Ошибка изменения аватара пользователя"})},i=document.querySelector("#card-template").content.querySelector(".places__item"),l="card__like-button_is-active",s=function(e,t,n){var o,r,c=i.cloneNode(!0),a=c.querySelector(".card__title"),u=c.querySelector(".card__image"),s=c.querySelector(".card__like-number"),d=c.querySelector(".card__delete-button"),p=c.querySelector(".card__like-button");return a.textContent=e.name,u.src=e.link,u.alt="Пейзажное фото места "+e.name,s.textContent=e.likes.length,t===e.owner._id?d.addEventListener("click",(function(t){n.deleteCardCallback(t,e._id)})):d.classList.add("card__delete-button_is-hidden"),o=e.likes,r=t,o.some((function(e){return e._id===r}))&&p.classList.add(l),p.addEventListener("click",(function(t){n.likeButtonCallback(t,e)})),u.addEventListener("click",(function(){n.zoomPhotoCallback(a.textContent,u.src,e.name)})),c},d=function(e){"Escape"===e.key&&m(document.querySelector(".popup_is-opened"))},p=function(e){e.target.classList.contains("popup")&&m(e.target)},f=function(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",d)},m=function(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",d)},_=function(e,t){e.classList.add(t),e.disabled=!0},v=function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.inputErrorClass),o.classList.remove(n.errorClass),o.textContent=""},y={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"},S=document.querySelector(".places__list"),h=document.querySelector(".popup_type_image"),C=document.querySelector(".popup_type_edit"),b=document.querySelector(".popup_type_new-card"),q=document.querySelector(".popup_type_avatar-edit"),k=document.querySelector(".profile__edit-button"),g=document.querySelector(".profile__add-button"),E=document.querySelector(".profile__image"),L=h.querySelector(".popup__image"),x=h.querySelector(".popup__caption"),M=document.querySelector("[name='edit-profile']"),B=document.querySelector(".profile__title"),P=document.querySelector(".profile__image"),U=document.querySelector(".profile__description"),A=document.querySelector("form[name='new-place']"),T=A.querySelector("input[name='place-name']"),w=A.querySelector("input[name='link']"),F=document.querySelector("form[name='avatar']"),R=F.querySelector("input[name='avatar-link']"),j={deleteCardCallback:function(e,o){var r=e.target.closest(".places__item");(function(e){return n({url:"".concat(t.cardsUrl,"/").concat(e),method:"DELETE",errMessage:"Ошибка удаления карточки"})})(o).then((function(e){r.remove()})).catch((function(e){console.log(e)}))},likeButtonCallback:function(e,t){var n=e.target,o=e.target.closest(".card__like").querySelector(".card__like-number");(n.classList.contains(l)?a:c)(t._id).then((function(e){o.textContent=e.likes.length,n.classList.toggle(l)})).catch((function(e){console.log(e)}))},zoomPhotoCallback:function(e,t,n){x.textContent=e,L.src=t,L.alt=n,L.onload=function(){f(h)}}},z=function(e,t){var n=e.querySelector("button[type='submit']");null!==n&&function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Сохранить",o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"Сохранение...";e.textContent=t?o:n}(n,t)},D=function(e){var t=e.popup.querySelector("form");e.event.preventDefault(),z(e.popup,!0),e.fetchFunction(e.data).then((function(n){e.processResult(n),m(e.popup),t.reset()})).catch(console.error).finally((function(){z(e.popup,!1)}))};Promise.all([n({url:t.cardsUrl,errMessage:"Ошибка получения карточек"}),n({url:t.profileUrl,errMessage:"Ошибка получения профиля пользователя"})]).then((function(e){var t=e[0],n=e[1];t.forEach((function(e){S.append(s(e,n._id,j))})),function(e){B.textContent=e.name,U.textContent=e.about,P.style.backgroundImage="url('".concat(e.avatar,"')")}(n)})).catch((function(e){console.log(e)})),[h,C,b,q].forEach((function(e){e.querySelector(".popup__close").addEventListener("click",(function(){m(e)})),e.addEventListener("click",p),e.classList.add("popup_is-animated"),z(e,!1)}));var V=function(e){var t=e.popup.querySelector("form");e.refreshContent?e.refreshContent():t.reset(),function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);n.forEach((function(n){v(e,n,t),n.setCustomValidity("")})),_(o,t.inactiveButtonClass)}(t,y),f(e.popup)};k.addEventListener("click",(function(){V({popup:C,refreshContent:function(){M.name.value=B.textContent,M.description.value=U.textContent}})})),g.addEventListener("click",(function(){V({popup:b})})),E.addEventListener("click",(function(){V({popup:q})})),M.addEventListener("submit",(function(e){var t={name:M.name.value,about:M.description.value};D({event:e,popup:C,fetchFunction:o,data:t,processResult:function(e){B.textContent=e.name,U.textContent=e.about}})})),A.addEventListener("submit",(function(e){var t={name:T.value,link:w.value};D({event:e,popup:b,fetchFunction:r,data:t,processResult:function(e){var t=s(e,e.owner._id,j);S.prepend(t)}})})),F.addEventListener("submit",(function(e){var t={avatar:R.value};D({event:e,popup:q,fetchFunction:u,data:t,processResult:function(e){P.style.backgroundImage="url('".concat(e.avatar,"')")}})})),function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){!function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);n.forEach((function(r){r.addEventListener("input",(function(){!function(e,t,n){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorPatternMessage):t.setCustomValidity(""),t.validity.valid?v(e,t,n):function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.add(n.inputErrorClass),o.textContent=t.validationMessage,o.classList.add(n.errorClass)}(e,t,n)}(e,r,t),function(e,t,n){var o,r;!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(o=t,r=n.inactiveButtonClass,o.classList.remove(r),o.disabled=!1):_(t,n.inactiveButtonClass)}(n,o,t)}))}))}(t,e)}))}(y)})();